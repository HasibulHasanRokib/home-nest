generator client {
  provider = "prisma-client"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  USER
  TENANT
  OWNER
  ADMIN
}

enum UserStatus {
  OPEN
  NOT_VERIFIED
  VERIFIED
  SUSPENDED
}

model User {
  id              String           @id @default(cuid())
  name            String
  email           String
  emailVerified   Boolean          @default(false)
  image           String?
  role            Role             @default(USER)
  status          UserStatus       @default(OPEN)
  credits         Int              @default(10)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  sessions        Session[]
  accounts        Account[]
  properties      Property[]
  propertyUnlocks PropertyUnlock[]
  rentals         Rental[]
  payments        Payment[]
  propertyReviews PropertyReview[]
  tenantBookings  BookingRequest[] @relation("TenantBookings")
  ownerBookings   BookingRequest[] @relation("OwnerBookings")
  packages        Package[]
  profile         Profile?
  address         Address?
  declaration     Declaration?

  @@unique([email])
  @@map("user")
}

model Session {
  id        String   @id @default(cuid())
  expiresAt DateTime
  token     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@index([userId])
  @@map("session")
}

model Account {
  id                    String    @id @default(cuid())
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([userId])
  @@map("account")
}

model Verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([identifier])
  @@map("verification")
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum Religion {
  ISLAM
  HINDUISM
  CHRISTIANITY
  BUDDHISM
  OTHER
}

enum HouseholdType {
  BACHELOR
  FAMILY
}

model Profile {
  id           String   @id @default(cuid())
  userId       String   @unique
  mobileNumber String
  dateOfBirth  DateTime
  gender       Gender
  religion     Religion
  occupation   String
  nidNumber    String
  attachment1  String
  attachment2  String

  bankAccount   String?
  mobileBanking String?
  familySize    Int?
  householdType HouseholdType?
  facebook      String?
  whatsapp      String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Address {
  id         String @id @default(cuid())
  userId     String @unique
  division   String
  district   String
  upazila    String
  postOffice String
  postCode   String
  details    String

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Declaration {
  id        String @id @default(cuid())
  userId    String @unique
  photo     String
  signature String
  user      User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum PropertyType {
  APARTMENT
  HOUSE
  ROOM
}

enum PetPolicy {
  ALLOWED
  NOT_ALLOWED
}

enum PropertyStatus {
  PENDING
  AVAILABLE
  RENTED
  REJECTED
}

model Property {
  id              String           @id @default(cuid())
  title           String
  slug            String           @unique
  location        String
  price           Int
  bedrooms        Int
  bathrooms       Int
  sqft            Int
  availableFrom   DateTime
  description     String
  leaseTerm       String
  amenities       String[]
  images          String[]
  propertyType    PropertyType
  petPolicy       PetPolicy
  status          PropertyStatus   @default(PENDING)
  propertyUnlocks PropertyUnlock[]
  rental          Rental?
  propertyReviews PropertyReview[]
  bookingRequests BookingRequest[]

  owner   User   @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  ownerId String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model PropertyUnlock {
  id         String   @id @default(cuid())
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId     String
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  propertyId String
  createdAt  DateTime @default(now())
}

model Rental {
  id         String    @id @default(cuid())
  tenantId   String
  propertyId String    @unique
  startDate  DateTime
  endDate    DateTime
  tenant     User      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  property   Property  @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  payments   Payment[]
  createdAt  DateTime  @default(now())
}

model Payment {
  id                String    @id @default(cuid())
  userId            String
  rentalId          String?
  bookingId         String?
  startDate         DateTime?
  description       String
  amount            Float
  paid              Boolean   @default(false)
  paymentMethod     String?
  transactionId     String    @unique
  paymentReceiptUrl String?
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  rental            Rental?   @relation(fields: [rentalId], references: [id], onDelete: Cascade)
  createdAt         DateTime  @default(now())
}

model PropertyReview {
  id         String   @id @default(cuid())
  rating     Float
  feedback   String?
  propertyId String
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  reviewerId String
  reviewer   User     @relation(fields: [reviewerId], references: [id], onDelete: Cascade)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

enum BookingStatus {
  PENDING
  APPROVED
  REJECTED
}

model BookingRequest {
  id         String        @id @default(cuid())
  propertyId String
  property   Property      @relation(fields: [propertyId], references: [id])
  tenantId   String
  tenant     User          @relation("TenantBookings", fields: [tenantId], references: [id])
  ownerId    String
  owner      User          @relation("OwnerBookings", fields: [ownerId], references: [id])
  status     BookingStatus @default(PENDING)
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt

  @@unique([propertyId, tenantId])
}

model Package {
  id            String  @id @default(cuid())
  userId        String
  transactionId String  @unique
  packageName   String
  active        Boolean @default(false)
  user          User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
